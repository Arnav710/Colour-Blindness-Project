<html>
<head>
<style>
div.footer {
	position: fixed;
	bottom: 0;
	left: 0;
	margin: 0 auto;
	background: #0072BB;
	color: #ffff00;
}
</style>
</head>
	

<body>

<p>Open image: <input type="file" id="inputImage"/></p>

<canvas id="canvas" style="margin:12px;"></canvas>

<div class="footer" id="results">Move mouse over image to show mouse location and pixel value and alpha</div>

<script>
var URL = window.URL;
var cvs = document.getElementById('canvas');
var ctx = cvs.getContext('2d');
var res = document.getElementById('results');

cvs.addEventListener('mousemove', mousePos, false);
cvs.addEventListener('click', copyMousePos, false);

window.onload = function() {
	var inputImage = document.getElementById('inputImage');
	inputImage.addEventListener('change', handleImageFiles, false);
}

function copyMousePos(evt) {
	var rect = cvs.getBoundingClientRect();
	var x = parseInt(evt.clientX - rect.left);
	var y = parseInt(evt.clientY - rect.top);
	copyText = x+';'+y
	navigator.clipboard.writeText(copyText).then(function() {
	  console.log('ok')
	}, function() {
	  console.log('ko')
	});
}


function compute_closest_colour(red, green, blue, col_list) {
	
	var closest_code = col_list[0][1];
	var closest_colour = col_list[0][0];
	var rgb_clicked = [red, green, blue];

	var best_deviaion = 0;
	for (let i = 0; i < 3; i++) {
		best_deviaion += Math.abs(rgb_clicked[i] - closest_code[i]);
	}
	best_deviaion /= 3;

	for (let i = 0; i < col_list.length; i++) {
		var colour_code = col_list[i][1];
		var colour = col_list[i][0];

		var deviation = 0;
		for (let i = 0; i < 3; i++) {
			deviation += Math.abs(rgb_clicked[i] - colour_code[i]);
		}
		deviation /= 3;

		if (deviation < best_deviaion) {
			best_deviaion = deviation;
            		closest_code = colour_code;
            		closest_colour = colour;
		}
	}

	if (best_deviaion <= 50) {
		return closest_colour;
	}
        
    	else {
		return "colour not recognised";
	}
        
}

function mousePos(evt) {

	var rect = cvs.getBoundingClientRect();
	var x = parseInt(evt.clientX - rect.left);
	var y = parseInt(evt.clientY - rect.top);
	var p = ctx.getImageData(x, y, 1, 1).data;

	var colour_list = [
["Black",[0,0,0]],
["White",[255,255,255]],
["Red",[255,0,0]],
["Lime",[0,255,0]],
["Blue",[0,0,255]],
["Yellow",[255,255,0]],
["Cyan / Aqua",[0,255,255]],
["Magenta",[255,0,255]],
["Silver",[192,192,192]],
["Gray",[128,128,128]],
["Maroon",[128,0,0]],
["Olive",[128,128,0]],
["Green",[0,128,0]],
["Purple",[128,0,128]],
["Teal",[0,128,128]],
["Navy",[0,0,128]],
["Maroon",[128,0,0]],
["Dark Red",[139,0,0]],
["Brown",[165,42,42]],
["Red",[255,0,0]],
["Tomato",[255,99,71]],
["Orange Red",[255,69,0]],
["Dark Orange",[255,140,0]],
["Orange",[255,165,0]],
["Gold",[255,215,0]],
["Dark Khaki",[189,183,107]],
["Khaki",[240,230,140]],
["Olive",[128,128,0]],
["Yellow",[255,255,0]],
["Yellow Green",[154,205,50]],
["Dark Olive Green",[85,107,47]],
["Lawn Green",[124,252,0]],
["Green Yellow",[173,255,47]],
["Dark Green",[0,100,0]],
["Green",[0,128,0]],
["Lime",[0,255,0]],
["Light Green",[144,238,144]],
["Pale Green",[152,251,152]],
["Teal",[0,128,128]],
["Dark Cyan",[0,139,139]],
["Aqua",[0,255,255]],
["Cyan",[0,255,255]],
["Light Cyan",[224,255,255]],
["Turquoise",[64,224,208]],
["Pale Turquoise",[175,238,238]],
["Light Blue",[173,216,230]],
["Sky Blue",[135,206,235]],
["Light Sky Blue",[135,206,250]],
["Midnight Blue",[25,25,112]],
["Navy",[0,0,128]],
["Dark Blue",[0,0,139]],
["Medium Blue",[0,0,205]],
["Blue",[0,0,255]],
["Royal Blue",[65,105,225]],
["Blue Violet",[138,43,226]],
["Indigo",[75,0,130]],
["Medium Purple",[147,112,219]],
["Dark Magenta",[139,0,139]],
["Dark Violet",[148,0,211]],
["Purple",[128,0,128]],
["Violet",[238,130,238]],
["Orchid",[218,112,214]],
["Deep Pink",[255,20,147]],
["Light Pink",[255,182,193]],
["Pink",[255,192,203]],
["Light Yellow",[255,255,224]],
["Chocolate",[210,105,30]],
["Sandy Brown",[244,164,96]],
["Burly Wood",[222,184,135]],
["Tan",[210,180,140]],
["Lavender",[230,230,250]],
["Ivory",[255,255,240]],
["Azure",[240,255,255]],
["Snow",[255,250,250]],
["Black",[0,0,0]],
["Dim Gray",[105,105,105]],
["Gray / Grey",[128,128,128]],
["Dark Gray / Dark Grey",[169,169,169]],
["Silver",[192,192,192]],
["White Smoke",[245,245,245]],
["White",[255,255,255]]

];

	results.innerHTML = '<table style="width:100%;table-layout:fixed"><td>Colour: ' 
		+ compute_closest_colour(p[0], p[1], p[2], colour_list) + "</td></table>";

	return {x, y};
}


function handleImageFiles(e) {	
	var url = URL.createObjectURL(e.target.files[0]);
	var img = new Image();
	img.onload = function() {
		var factor = 400 / img.height;
		cvs.width = img.width * factor;
		cvs.height = img.height * factor;
		ctx.drawImage(img, 0, 0, width = cvs.width, height = cvs.height);    
	}
	img.src = url;
}

</script>
</body>
</html>
